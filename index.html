<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Code Refactor Tool</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        :root {
            /* Technical Color Scheme - Dark theme with developer vibes */
            --primary: #0ea5e9;
            --primary-dark: #0284c7;
            --secondary: #8b5cf6;
            --accent: #10b981;
            --bg-main: #0f172a;
            --bg-secondary: #1e293b;
            --bg-tertiary: #334155;
            --text-primary: #f1f5f9;
            --text-secondary: #cbd5e1;
            --text-muted: #64748b;
            --border: #334155;
            --shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        }
        
        body {
            background: var(--bg-main);
            color: var(--text-primary);
            line-height: 1.6;
            min-height: 100vh;
            padding: 20px;
        }
        
        .layout {
            display: flex;
            gap: 20px;
            max-width: 1400px;
            margin: 0 auto;
        }
        
        /* Left Sidebar - Explanation Panel */
        .explanation-panel {
            width: 300px;
            background-color: var(--bg-secondary);
            border-radius: 12px;
            padding: 25px;
            box-shadow: var(--shadow);
            border: 1px solid var(--border);
            height: fit-content;
            position: sticky;
            top: 20px;
        }
        
        .explanation-panel h3 {
            color: var(--primary);
            margin-bottom: 15px;
            font-size: 1.2rem;
        }
        
        .explanation-section {
            margin-bottom: 20px;
        }
        
        .explanation-section h4 {
            color: var(--text-primary);
            margin-bottom: 8px;
            font-size: 0.95rem;
        }
        
        .explanation-section p {
            color: var(--text-secondary);
            font-size: 0.9rem;
            line-height: 1.6;
        }
        
        /* Main Container */
        .container {
            flex: 1;
            background-color: var(--bg-secondary);
            border-radius: 12px;
            box-shadow: var(--shadow);
            overflow: hidden;
            border: 1px solid var(--border);
        }
        
        header {
            background: linear-gradient(120deg, var(--primary), var(--secondary));
            color: white;
            padding: 25px 30px;
            text-align: center;
        }
        
        h1 {
            font-weight: 700;
            margin-bottom: 8px;
            font-size: 2.2rem;
        }
        
        .subtitle {
            opacity: 0.9;
            font-size: 1.1rem;
        }
        
        .main-content {
            padding: 30px;
        }
        
        /* Try Me Button Section */
        .try-me-section {
            margin-bottom: 25px;
            padding: 15px;
            background: var(--bg-main);
            border-radius: 8px;
            border: 1px solid var(--border);
        }
        
        .try-me-section p {
            color: var(--text-secondary);
            margin-bottom: 12px;
            font-size: 0.95rem;
        }
        
        .try-me-btn {
            background: linear-gradient(120deg, var(--secondary), var(--primary));
            color: white;
            border: none;
            padding: 10px 20px;
            font-size: 0.95rem;
            font-weight: 600;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }
        
        .try-me-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(139, 92, 246, 0.4);
        }
        
        .input-section {
            margin-bottom: 25px;
        }
        
        .input-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            flex-wrap: wrap;
            gap: 15px;
        }
        
        .language-selector {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .language-selector label {
            font-weight: 600;
            color: var(--text-secondary);
        }
        
        select {
            padding: 8px 12px;
            border: 1px solid var(--border);
            border-radius: 6px;
            background-color: var(--bg-tertiary);
            font-size: 14px;
            color: var(--text-primary);
            cursor: pointer;
            transition: border-color 0.3s;
        }
        
        select:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 2px rgba(14, 165, 233, 0.2);
        }
        
        .code-input {
            width: 100%;
            min-height: 300px;
            padding: 20px;
            border: 1px solid var(--border);
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            font-size: 15px;
            resize: vertical;
            background-color: var(--bg-main);
            transition: border-color 0.3s;
            line-height: 1.5;
            color: var(--text-primary);
        }
        
        .code-input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 2px rgba(14, 165, 233, 0.2);
        }
        
        .file-upload {
            margin: 20px 0;
            display: flex;
            align-items: center;
            flex-wrap: wrap;
            gap: 15px;
        }
        
        .file-label {
            background-color: var(--bg-tertiary);
            color: var(--text-primary);
            padding: 10px 20px;
            border-radius: 6px;
            cursor: pointer;
            transition: background-color 0.3s;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            font-weight: 500;
            border: 1px solid var(--border);
        }
        
        .file-label:hover {
            background-color: var(--bg-main);
            border-color: var(--primary);
        }
        
        .file-input {
            display: none;
        }
        
        .file-name {
            color: var(--text-muted);
            font-style: italic;
        }
        
        .actions {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 16px;
            flex-wrap: wrap;
            margin-top: 25px;
        }
        
        .refactor-btn {
            background: linear-gradient(120deg, var(--primary), var(--accent));
            color: white;
            border: none;
            padding: 14px 40px;
            font-size: 16px;
            font-weight: 600;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 10px;
            box-shadow: 0 4px 10px rgba(14, 165, 233, 0.3);
        }
        
        .refactor-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 15px rgba(14, 165, 233, 0.4);
        }
        
        .refactor-btn:active {
            transform: translateY(0);
        }
        
        .refactor-btn:disabled {
            opacity: 0.7;
            cursor: not-allowed;
            transform: none;
        }
        
        .output-section {
            margin-top: 40px;
            display: none;
            animation: fadeIn 0.5s ease;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        .output-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            flex-wrap: wrap;
            gap: 15px;
        }
        
        .output-header h2 {
            color: var(--text-primary);
            font-weight: 600;
        }
        
        .copy-btn {
            background-color: var(--accent);
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 6px;
            cursor: pointer;
            transition: background-color 0.3s;
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 14px;
        }
        
        .copy-btn:hover {
            background-color: #059669;
        }
        
        .code-output {
            width: 100%;
            min-height: 300px;
            padding: 20px;
            border: 1px solid var(--border);
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            font-size: 15px;
            background-color: var(--bg-main);
            white-space: pre-wrap;
            line-height: 1.5;
            color: var(--text-primary);
        }
        
        footer {
            text-align: center;
            padding: 20px;
            color: var(--text-muted);
            font-size: 0.9rem;
            border-top: 1px solid var(--border);
        }
        
        .spinner {
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
        
        @media (max-width: 1024px) {
            .layout {
                flex-direction: column;
            }
            
            .explanation-panel {
                width: 100%;
                position: static;
            }
        }
        
        @media (max-width: 768px) {
            .container {
                border-radius: 8px;
            }
            
            header {
                padding: 20px;
            }
            
            h1 {
                font-size: 1.8rem;
            }
            
            .main-content {
                padding: 20px;
            }
            
            .code-input, .code-output {
                min-height: 250px;
                font-size: 14px;
            }
            
            .input-header, .output-header {
                flex-direction: column;
                align-items: flex-start;
            }
        }
    </style>
</head>
<body>
    <div class="layout">
        <!-- Left Side: Explanation Panel -->
        <aside class="explanation-panel">
            <h3><i class="fas fa-info-circle"></i> How It Works</h3>
            
            <div class="explanation-section">
                <h4>1. Code Analysis</h4>
                <p>Our tool analyzes your code to identify patterns, inefficiencies, and areas for improvement.</p>
            </div>
            
            <div class="explanation-section">
                <h4>2. Smart Refactoring</h4>
                <p>Applies best practices and modern coding standards to optimize your code structure.</p>
            </div>
            
            <div class="explanation-section">
                <h4>3. Quality Check</h4>
                <p>Validates the refactored code to ensure it maintains functionality while improving readability.</p>
            </div>
            
            <div class="explanation-section">
                <h4>4. Get Results</h4>
                <p>Review your improved code with better naming, structure, and documentation.</p>
            </div>
        </aside>
        
        <!-- Right Side: Main Content -->
        <div class="container">
            <header>
                <h1>NeatCode - Code Refactor Tool</h1>
                <p class="subtitle">Paste your code or upload a file to refactor</p>
            </header>
            
            <div class="main-content">
                <!-- Try Me Section -->
                <div class="try-me-section">
                    <p><i class="fas fa-lightbulb"></i> <strong>Try it out:</strong> Click the button below to load a sample JavaScript code</p>
                    <button class="try-me-btn" id="tryMeBtn">
                        <i class="fas fa-play"></i>
                        Try Me - Load Sample Code
                    </button>
                </div>
                
                <div class="input-section">
                    <div class="input-header">
                        <h2>Input Code</h2>
                        <div class="language-selector">
                            <label for="language-select"><i class="fas fa-code"></i> Language:</label>
                            <select id="language-select">
                                <option value="auto">Auto-detect</option>
                                <option value="javascript">JavaScript</option>
                                <option value="python">Python</option>
                                <option value="java">Java</option>
                                <option value="cpp">C++</option>
                                <option value="csharp">C#</option>
                                <option value="php">PHP</option>
                                <option value="html">HTML</option>
                                <option value="css">CSS</option>
                                <option value="sql">SQL</option>
                                <option value="ruby">Ruby</option>
                                <option value="swift">Swift</option>
                            </select>
                        </div>
                    </div>
                    
                    <textarea class="code-input" placeholder="Paste your code here..."></textarea>
                    
                    <div class="file-upload">
                        <label for="file-input" class="file-label">
                            <i class="fas fa-file-upload"></i>
                            Upload Code File
                        </label>
                        <input type="file" id="file-input" class="file-input" accept=".txt,.js,.py,.java,.cpp,.c,.cs,.php,.html,.css,.json,.xml,.rb,.swift">
                        <span class="file-name">No file selected</span>
                    </div>
                </div>
                
                <div class="actions">
                    <button class="refactor-btn">
                        <i class="fas fa-magic"></i>
                        Refactor Code
                    </button>
                </div>

                <div class="output-section">
                    <div class="output-header">
                        <h2>Refactored Code</h2>
                        <button class="copy-btn">
                            <i class="far fa-copy"></i>
                            Copy to Clipboard
                        </button>
                    </div>
                    <div class="code-output"></div>
                </div>
            </div>
            
            <footer>
                <p>NeatCode - Code Refactor Tool &copy; 2025 | Clean, efficient, and beautiful code refactoring</p>
            </footer>
        </div>
    </div>

	<script>
		document.addEventListener('DOMContentLoaded', function() {
            const LOCAL_BACKEND = "http://127.0.0.1:8000"; // Backend configuration
            // Actual URL where FastAPI is deployed
            // const PROD_BACKEND  = "https://your-backend-host.example.com";
            const PROD_BACKEND  = "http://127.0.0.1:8000"; // for now (Since hosting on laptop)
            const GITHUB_HOST   = "arun-sidhu.github.io"; // GitHub Pages host
	
			const params = new URLSearchParams(window.location.search);
			const backendParam = params.get("backend"); // "local", "prod", "demo", or null
			
			let USE_BACKEND;
			let API_BASE;
			
			if (backendParam === "local") {
			    // Force local backend
			    USE_BACKEND = true;
			    API_BASE = LOCAL_BACKEND;
			} else if (backendParam === "prod") {
			    // Force deployed backend
			    USE_BACKEND = true;
			    API_BASE = PROD_BACKEND;
			} else if (backendParam === "demo") {
			    // No backend; use in-browser simulation
			    USE_BACKEND = false;
			    API_BASE = null;
			} else {
			    // Auto mode:
			    // - If running from GitHub Pages, use PROD
			    // - Otherwise (e.g., opening file locally or via Live Server), use LOCAL
			    if (window.location.hostname === GITHUB_HOST) {
			        USE_BACKEND = true;
			        API_BASE = PROD_BACKEND;
			    } else {
			        USE_BACKEND = true;
			        API_BASE = LOCAL_BACKEND;
			    }
			}
			
			console.log("USE_BACKEND =", USE_BACKEND, "API_BASE =", API_BASE);
	
			const fileInput = document.getElementById('file-input');
			const fileName = document.querySelector('.file-name');
			const codeInput = document.querySelector('.code-input');
			const languageSelect = document.getElementById('language-select');
			const refactorBtn = document.querySelector('.refactor-btn');
			const outputSection = document.querySelector('.output-section');
			const codeOutput = document.querySelector('.code-output');
			const copyBtn = document.querySelector('.copy-btn');
			const tryMeBtn = document.getElementById('tryMeBtn');
			
			// Sample code for Try Me button
			const sampleCode = `function calculateTotal(items) {
		var total = 0;
		for (var i = 0; i < items.length; i++) {
			total = total + items[i].price;
		}
		return total;
	}
	
	var items = [
		{name: 'Apple', price: 1.50},
		{name: 'Banana', price: 0.75},
		{name: 'Orange', price: 2.00}
	];
	
	console.log('Total: $' + calculateTotal(items));`;
			
			// Try Me button functionality
			tryMeBtn.addEventListener('click', function() {
				codeInput.value = sampleCode;
				languageSelect.value = 'javascript';
				
				// Visual feedback
				codeInput.style.borderColor = 'var(--primary)';
				setTimeout(() => {
					codeInput.style.borderColor = '';
				}, 1000);
				
				// Scroll to input
				codeInput.scrollIntoView({ behavior: 'smooth', block: 'center' });
			});
			
			// Handle file upload
			fileInput.addEventListener('change', function() {
				if (this.files.length > 0) {
					fileName.textContent = this.files[0].name;
					
					// Try to detect language from file extension
					const extension = this.files[0].name.split('.').pop().toLowerCase();
					detectLanguageFromExtension(extension);
					
					const reader = new FileReader();
					reader.onload = function(e) {
						codeInput.value = e.target.result;
					};
					reader.readAsText(this.files[0]);
				} else {
					fileName.textContent = 'No file selected';
				}
			});
			
			// Detect language from file extension
			function detectLanguageFromExtension(ext) {
				const languageMap = {
					'js': 'javascript',
					'py': 'python',
					'java': 'java',
					'cpp': 'cpp',
					'c': 'cpp',
					'cs': 'csharp',
					'php': 'php',
					'html': 'html',
					'css': 'css',
					'sql': 'sql',
					'rb': 'ruby',
					'swift': 'swift'
				};
				
				if (languageMap[ext]) {
					languageSelect.value = languageMap[ext];
				}
			}
	
			// ---- Optional backend call ----
			async function refactorViaAPI(code, language) {
				const payload = {
					code: code,
					language: language || "auto"
				};
	
				const response = await fetch(`${API_BASE}/api/refactor`, {
					method: "POST",
					headers: {
						"Content-Type": "application/json"
					},
					body: JSON.stringify(payload)
				});
	
				if (!response.ok) {
					let msg = `Request failed with status ${response.status}`;
					try {
						const data = await response.json();
						if (data.detail) msg = data.detail;
					} catch (_) {}
					throw new Error(msg);
				}
	
				// Expected: { refactored_code, explanation }
				return response.json();
			}
	
			// Unified refactor function:
			// - Demo mode: uses simulateRefactoring in-browser
			// - Backend mode: tries API, falls back to simulateRefactoring on error
			async function runRefactor(code, language) {
				if (!USE_BACKEND) {
					// Pure front-end / demo mode
					return {
						refactored_code: simulateRefactoring(code, language),
						explanation: "Demo mode: running locally in the browser without calling a backend."
					};
				}
	
				try {
					return await refactorViaAPI(code, language);
				} catch (err) {
					console.error("Backend failed, falling back to local simulation:", err);
					return {
						refactored_code: simulateRefactoring(code, language),
						explanation: "Backend call failed or is not configured, so a local simulated refactor was used instead."
					};
				}
			}
			
			// Handle refactor button click
			refactorBtn.addEventListener('click', async function() {
				const code = codeInput.value.trim();
				const language = languageSelect.value;
				
				if (code === '') {
					alert('Please enter or upload some code to refactor.');
					return;
				}
				
				// Show loading state
				refactorBtn.disabled = true;
				refactorBtn.innerHTML = `
					<i class="fas fa-spinner spinner"></i>
					Refactoring...
				`;
				
				try {
					const result = await runRefactor(code, language);
					codeOutput.textContent = result.refactored_code;
					outputSection.style.display = 'block';
	
					// If you later add a dynamic explanation element, you can hook it here:
					// const expl = document.getElementById('ai-explanation-text');
					// if (expl && result.explanation) expl.textContent = result.explanation;
					
					// Scroll to output
					outputSection.scrollIntoView({ behavior: 'smooth' });
				} catch (err) {
					console.error(err);
					alert(`Refactor failed: ${err.message}`);
				} finally {
					// Reset button
					refactorBtn.disabled = false;
					refactorBtn.innerHTML = `
						<i class="fas fa-magic"></i>
						Refactor Code
					`;
				}
			});
			
			// Handle copy button click
			copyBtn.addEventListener('click', function() {
				const textToCopy = codeOutput.textContent;
				
				if (textToCopy.trim() === '') {
					alert('No code to copy!');
					return;
				}
				
				navigator.clipboard.writeText(textToCopy)
					.then(() => {
						// Visual feedback
						const originalText = copyBtn.innerHTML;
						copyBtn.innerHTML = '<i class="fas fa-check"></i> Copied!';
						copyBtn.style.backgroundColor = '#10b981';
						
						setTimeout(() => {
							copyBtn.innerHTML = originalText;
							copyBtn.style.backgroundColor = '';
						}, 2000);
					})
					.catch(err => {
						console.error('Failed to copy: ', err);
						alert('Failed to copy code to clipboard');
					});
			});
			
			// Simple simulation of refactoring (front-end only)
			function simulateRefactoring(code, language) {
				const languageName = language === 'auto' ? 'auto-detected' : language;
				
				return `// Refactored code (${languageName})
	// This is a simulation - a real tool would provide actual refactoring
	
	${code}
	
	// Refactoring completed
	// Code has been optimized for readability and maintainability`;
			}
		});
	</script>

</body>
</html>
